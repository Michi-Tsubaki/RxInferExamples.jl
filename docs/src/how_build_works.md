# How the Build System Works

This document explains the build system for RxInfer.jl Examples. The build process involves two main scripts:
`examples/make.jl` and `docs/make.jl`, each serving a different purpose.

## Overview

The build process happens in two stages:
1. Converting notebooks to markdown (`examples/make.jl`)
2. Building the documentation (`docs/make.jl`)

## Stage 1: Notebook Processing (`examples/make.jl`)

This script handles the conversion of Jupyter notebooks to markdown files. Key features:

### Directory Structure
```
examples/make.jl
├── BUILD_DIR (docs/src/examples/)
├── FIG_DIR (docs/src/assets/example-figures/)
└── CACHE_DIR (docs/src/examples/_cache/)
```

### Key Functions

1. **Notebook Processing**
   - Converts `.ipynb` to `.md` using Weave.jl
   - Preserves notebook environment (Project.toml)
   - Handles figure generation and caching
   - Adds contribution notes to each example

2. **Auxiliary File Handling**
   - Copies all supporting files (data, etc.)
   - Excludes Manifest.toml files
   - Maintains directory structure

3. **Error Handling**
   - Checks for error blocks in output
   - Reports failed conversions
   - Provides detailed error context

### Parallel Processing
- Uses Julia's distributed computing
- Processes notebooks in parallel
- Reports success/failure statistics

## Stage 2: Documentation Building (`docs/make.jl`)

This script builds the final documentation. Key features:

### Directory Structure
```
docs/make.jl
├── src/
│   ├── examples/           # Converted notebooks
│   ├── autogenerated/     # Generated content
└── assets/
    └── example-figures/ # Example figures
```

### Key Functions

1. **Metadata Collection**
   - Reads `meta.jl` from each example
   - Collects titles, descriptions, and tags
   - Groups examples by category

2. **Page Generation**
   - Creates list of examples page
   - Generates navigation structure
   - Handles HTML styling for examples list

3. **Documentation Building**
   - Uses Documenter.jl
   - Handles deployment to GitHub Pages
   - Manages clean builds

## Build Process

1. **Clean Build** (`make clean`)
   ```bash
   rm -rf docs/build
   rm -rf docs/src/examples
   rm -rf docs/src/autogenerated
   rm -rf docs/src/assets/example-figures
   rm -rf examples/cache
   ```

2. **Build Examples** (`make examples`)
   - Processes all notebooks
   - Generates markdown files
   - Creates figures
   - Copies auxiliary files

3. **Build Documentation** (`make docs`)
   - Generates example list
   - Builds HTML documentation
   - Prepares for deployment

## Tips for Developers

1. **Adding New Examples**
   - Place notebook in appropriate category folder
   - Include `meta.jl` with required metadata
   - Add any necessary Project.toml
   - Test locally with `make example FILTER=YourNotebook`

2. **Debugging**
   - Use `make clean` before rebuilding
   - Check error messages in build output
   - Verify figure paths in notebooks
   - Ensure all dependencies are in Project.toml

3. **Common Issues**
   - Missing dependencies in Project.toml
   - Incorrect figure paths
   - Cache-related issues
   - Environment activation problems

## CI/CD Integration

The build system is integrated with GitHub Actions:
- Runs on pull requests and main branch
- Weekly scheduled builds
- Automatic documentation deployment
- Caches build artifacts for efficiency
